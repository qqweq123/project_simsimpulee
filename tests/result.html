<!DOCTYPE html>
<html lang="ko">
<!-- ì•ì— .. ì„ ë¶™ì—¬ì„œ ìƒìœ„ í´ë”ë¡œ ë‚˜ê°„ ë’¤ cssë¥¼ ì°¾ìŠµë‹ˆë‹¤ -->
<link rel="stylesheet" href="../css/image_transform.css">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…ŒìŠ¤íŠ¸ ê²°ê³¼ - Mellow Wave</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&family=Noto+Sans+KR:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .blur-content {
            filter: blur(8px);
            user-select: none;
            pointer-events: none;
        }

        .lock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.6);
            z-index: 10;
        }
    </style>
</head>

<body class="bg-[var(--bg-primary)] min-h-screen flex flex-col items-center py-8">

    <!-- Side Ads (Desktop Only) -->
    <div class="side-ad side-ad-left">
        <p>ì™¼ìª½ ê´‘ê³  ë°°ë„ˆ</p>
        <div style="background:#eee; width:140px; height:500px; margin-top:10px;"></div>
    </div>
    <div class="side-ad side-ad-right">
        <p>ì˜¤ë¥¸ìª½ ê´‘ê³  ë°°ë„ˆ</p>
        <div style="background:#eee; width:140px; height:500px; margin-top:10px;"></div>
    </div>

    <!-- Ad-Block Detection Modal -->
    <div id="adblock-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-3xl p-8 max-w-sm text-center animate-bounce-in">
            <span class="text-6xl mb-4 block">ğŸ˜¢</span>
            <h3 class="font-gaegu text-2xl font-bold mb-2">ê´‘ê³  ì°¨ë‹¨ì„ í•´ì œí•´ ì£¼ì„¸ìš” ğŸ¥²</h3>
            <p class="text-gray-600 mb-6 text-sm leading-relaxed">
                Mellow WaveëŠ” ì—¬ëŸ¬ë¶„ì˜ ê´€ì‹¬ìœ¼ë¡œ ìš´ì˜ë©ë‹ˆë‹¤.<br>
                ê·€ì—¬ìš´ í…ŒìŠ¤íŠ¸ë¥¼ ê³„ì† ë§Œë“¤ ìˆ˜ ìˆë„ë¡<br>
                <strong>AdBlock</strong>ì„ ì ì‹œ êº¼ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!
            </p>
            <button onclick="location.reload()"
                class="bg-[var(--color-primary)] text-white font-bold py-2 px-6 rounded-full hover:bg-opacity-90 transition shadow-md">
                ì°¨ë‹¨ í•´ì œí–ˆì–´ìš”! (ìƒˆë¡œê³ ì¹¨)
            </button>
        </div>
    </div>

    <div class="max-w-md w-full px-4 relative z-0">
        <h1 class="font-gaegu text-3xl font-bold text-center mb-6 text-[var(--color-accent)]">ë‚˜ì˜ ê²°ê³¼ëŠ”?</h1>

        <!-- ê²°ê³¼ ì¹´ë“œ -->
        <div id="result-card" class="bg-white rounded-3xl shadow-xl overflow-hidden relative fade-in">

            <!-- ì ê¸ˆ í™”ë©´ (Overlay) -->
            <div id="lock-overlay" class="lock-overlay">
                <div class="text-center p-6 bg-white/90 rounded-2xl shadow-2xl border border-yellow-200">
                    <span class="text-4xl mb-2 block">ğŸ”’</span>
                    <h3 class="text-xl font-bold mb-2">ê²°ê³¼ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤!</h3>
                    <p class="text-sm text-gray-500 mb-4">ê²°ê³¼ë¥¼ í™•ì¸í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>

                    <button onclick="unlockResult()"
                        class="btn-press w-full bg-[var(--color-secondary)] text-white font-bold py-3 px-6 rounded-full shadow-lg hover:brightness-110 transition-all mb-3 animate-pulse">
                        ë¬´ë£Œë¡œ ê²°ê³¼ í™•ì¸í•˜ê¸° ğŸ
                    </button>
                    <!-- Future Payment Placeholder -->
                    <button
                        class="w-full bg-gray-200 text-gray-500 font-bold py-3 px-6 rounded-full text-sm cursor-not-allowed"
                        disabled>
                        í”„ë¦¬ë¯¸ì—„ ì •ë°€ ë¶„ì„ (ì¤€ë¹„ì¤‘)
                    </button>
                </div>
            </div>

            <!-- ì‹¤ì œ ê²°ê³¼ ë‚´ìš© (ë¸”ëŸ¬ ì²˜ë¦¬ë¨) -->
            <div id="result-content" class="blur-content p-8 text-center transition-all duration-700">
                <img id="result-img" src=""
                    class="mx-auto rounded-full mb-6 w-48 h-48 object-cover bg-gray-100 shadow-md">
                <h2 id="result-title" class="text-3xl font-bold text-[var(--text-dark)] mb-2 break-keep"></h2>
                <h3 id="result-subtitle" class="text-lg text-[var(--color-primary)] font-bold mb-6"></h3>

                <div class="flex justify-center gap-2 mb-6" id="result-tags">
                    <!-- íƒœê·¸ë“¤ì´ ë™ì ìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
                </div>

                <p id="result-desc"
                    class="text-gray-600 text-sm leading-7 mb-8 text-left bg-gray-50 p-6 rounded-xl min-h-[100px] whitespace-pre-line border border-gray-100">
                    ...
                </p>

                <!-- ê¶í•© ì •ë³´ ì„¹ì…˜ (New) -->
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <!-- í™˜ìƒì˜ ì§ê¿ -->
                    <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100">
                        <h4 class="text-xs font-bold text-blue-400 mb-2">í™˜ìƒì˜ ì§ê¿ ğŸ¬</h4>
                        <div id="good-match-name" class="text-sm font-bold text-gray-700 break-keep"></div>
                    </div>
                    <!-- í™˜ì¥ì˜ ì§ê¿ -->
                    <div class="bg-red-50 p-4 rounded-2xl border border-red-100">
                        <h4 class="text-xs font-bold text-red-400 mb-2">ì‚´ì§ ìŒ‰ì‹¸ë¦„í•´ìš” â˜•</h4>
                        <div id="bad-match-name" class="text-sm font-bold text-gray-700 break-keep"></div>
                    </div>
                </div>

                <!-- ìƒìš©í™”: ê³µìœ  & ì¹œêµ¬ ì°¾ê¸° -->
                <div class="border-t border-gray-100 pt-6">
                    <h4 class="font-bold mb-4 text-sm">ê²°ê³¼ ê³µìœ í•˜ê³  ë‚´ ì§ê¿ ì°¾ê¸°</h4>
                    <div class="flex justify-center gap-4">
                        <button class="p-3 bg-yellow-300 rounded-full hover:scale-110 transition shadow-sm btn-press">ğŸŸ¡
                            ì¹´ì¹´ì˜¤</button>
                        <button
                            class="p-3 bg-blue-500 text-white rounded-full hover:scale-110 transition shadow-sm btn-press">ğŸ”µ
                            í˜ì´ìŠ¤ë¶</button>
                        <button onclick="copyLink()"
                            class="p-3 bg-gray-200 rounded-full hover:scale-110 transition shadow-sm btn-press">ğŸ”—
                            ë§í¬</button>
                    </div>
                </div>

                <!-- ê´‘ê³  ìŠ¬ë¡¯ -->
                <div class="mt-8 h-20 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400 text-xs">
                    Advertisement Area
                </div>
            </div>
        </div>

        <!-- í•˜ë‹¨ ë²„íŠ¼ -->
        <div class="mt-8 text-center space-y-4">
            <a href="test_list.html"
                class="btn-press block w-full bg-white border border-[var(--color-primary)] text-[var(--color-primary)] font-bold py-3 rounded-xl hover:bg-yellow-50 transition">
                ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ í•˜ëŸ¬ ê°€ê¸° ğŸ¨
            </a>
            <a href="../index.html" class="inline-block text-gray-400 underline text-sm hover:text-gray-600">
                ë©”ì¸ í™ˆìœ¼ë¡œ ì´ë™
            </a>
        </div>
    </div>

    <script type="module">
        import { dessertResults, matchData } from './dessert_data.js';

        document.addEventListener('DOMContentLoaded', () => {
            // 1. Parse URL Parameter
            const urlParams = new URLSearchParams(window.location.search);
            const type = urlParams.get('type') || 'ESFP';

            // 2. Load Data
            const result = dessertResults[type];

            if (result) {
                document.getElementById('result-title').innerText = result.name;
                document.getElementById('result-subtitle').innerText = result.subtitle || "";
                document.getElementById('result-desc').innerText = result.desc;

                // íƒœê·¸ ë Œë”ë§
                const tagContainer = document.getElementById('result-tags');
                tagContainer.innerHTML = '';
                if (result.tags) {
                    result.tags.forEach(tag => {
                        const span = document.createElement('span');
                        span.className = "px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-bold";
                        span.innerText = tag;
                        tagContainer.appendChild(span);
                    });
                }

                // ì´ë¯¸ì§€ í”Œë ˆì´ìŠ¤í™€ë”
                document.getElementById('result-img').src = `https://placehold.co/200x200/FFD166/4A4A4A?text=${result.name}`;

                // ê¶í•© ì •ë³´ ë Œë”ë§
                if (result.goodMatch && matchData[result.goodMatch]) {
                    document.getElementById('good-match-name').innerText = matchData[result.goodMatch];
                }
                if (result.badMatch && matchData[result.badMatch]) {
                    document.getElementById('bad-match-name').innerText = matchData[result.badMatch];
                }
            }

            // 3. Ad-Block & Lock Logic
            checkAdLockStatus();
        });

        // ì „ì—­ í•¨ìˆ˜ë¡œ ì„¤ì • (HTML onclickì—ì„œ ë¶€ë¥´ê¸° ìœ„í•´ window ê°ì²´ì— í• ë‹¹)
        window.unlockResult = function () {
            window.open('https://www.coupang.com', '_blank');
            localStorage.setItem('adUnlockTime', Date.now());

            const overlay = document.getElementById('lock-overlay');
            const content = document.getElementById('result-content');
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                content.classList.remove('blur-content');
            }, 500);
        }

        function checkAdLockStatus() {
            const unlockTime = localStorage.getItem('adUnlockTime');
            if (unlockTime) {
                const now = Date.now();
                if (now - parseInt(unlockTime) < 60 * 60 * 1000) {
                    window.unlockResult(); // Re-use unlock logic logic but without popup if already unlocked? 
                    // No, avoid popup. Manual implementation:
                    document.getElementById('lock-overlay').style.display = 'none';
                    document.getElementById('result-content').classList.remove('blur-content');
                }
            }
        }

        window.copyLink = function () {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }
    </script>

    <!-- Ad Block Script (Separate non-module script ok?) -->
    <script>
        // Bait for AdBlock
        document.addEventListener('DOMContentLoaded', function () {
            const bait = document.createElement('div');
            bait.innerHTML = '&nbsp;';
            bait.className = 'adsbox';
            bait.style.position = 'absolute';
            bait.style.top = '-1000px';
            bait.style.left = '-1000px';
            document.body.appendChild(bait);
            setTimeout(function () {
                if (bait.offsetHeight === 0 || bait.style.display === 'none') {
                    document.getElementById('adblock-modal').classList.remove('hidden');
                    document.getElementById('adblock-modal').classList.add('flex');
                }
                document.body.removeChild(bait);
            }, 500);
        });
    </script>
</body>

</html>