# Mellow Wave Platform: Advanced Data Architecture & Phase 2 Roadmap

**작성 날짜**: 2026-02-24
**작성자**: Mellow Wave 데이터 통합 처리 총괄 디렉터 (Data Architecture Director)

> **목적**: 본 문서는 '무인도 생존 유형 테스트(Island Test)' 리뉴얼 프로젝트를 관통하며 정립된 초기 표준 규격(`standard_architecture_guide.md`)을 상용화에 걸맞은 수준으로 초(超)고도화한 문서입니다. 향후 Mellow Wave의 모든 심리테스트가 의존하게 될 **데이터 파이프라인, 텔레메트리, 구조적 템플릿 규격**의 단일 진실 공급원(SSOT) 역할을 합니다.

---

## 1. 프론트엔드 및 데이터 파이프라인 표준 규격 (Foundation)

Mellow Wave의 기술 부채(Technical Debt)를 최소화하고 퍼포먼스를 유지하기 위한 기저 아키텍처 룰셋입니다.

*   **데이터 포맷**: 사이트 방문자의 경험을 해치지 않는 선에서 가장 최저 수준으로 절감된 데이터 용량을 탐색해야 합니다. 서비스의 배경, 썸네일, 배너 등 모든 비트맵 레이어는 예외 없이 **`WebP`** 포맷으로 렌더링하여 트래픽 비용을 80% 이상 절감합니다.
*   **저장소 거버넌스 및 AI 클렌징**: 에셋은 깃허브 로컬이 아닌 **Supabase CDN (`test_image` 버킷)** 에 분산 캐싱됩니다. 저장소 데이터 분류는 유지/보수/확장성을 위해 체계적으로 네이밍 디렉토리화 해야 합니다. (이전 AI 캔버스 쓰레기값이 포함되던 현상은 Node.js 기반의 전처리 크롭 워크플로우를 통해 완전 진압되었습니다.)
*   **UI/UX 렌더링 규격**:
    *   **심리스 텍스처**: 타일링 가능한 WebP 텍스처를 생성하고 `mix-blend-mode: multiply`를 통해 통짜 로딩을 방지.
    *   **파노라마 프로모션 배너 (V9 Hybrid)**: 추천 피드 배너는 **1200 x 330 (4:1의 와이드 파노라마 비율)** 규격으로 고정합니다. 좌우 네거티브 마진(`-mx-8`)으로 화면 엣지에 딱 맞붙는 풀블리드 레이아웃을 생성하되, 캡슐 형태를 유지하기 위해 모서리는 `rounded-2xl`을 엄수합니다.

---

## 2. Phase 2 단기 우선 목표: 상용화 및 고도화 마스터플랜

본 2장은 즉각적인 코드 수정 및 파이프라인 마이그레이션이 수반되는 최우선 순위 목표(Roadmap)입니다.

### 2.1 코드 검토 및 보안/템플릿 구조화 (Code Review)
*   현재 `island_test`의 코드를 데이터 공학적 관점에서 면밀히 검토하여, 가독성/유지보수성 저해 요인 및 오류/중복 코드를 전면 제거합니다.
*   클라이언트 사이드에서의 결과 조작이나 트래픽 어뷰징 등 **보안 위배 사항과 중대 이슈**가 있는지 면밀히 감시하고 수정합니다.
*   이 모든 설계는 단발성 이벤트가 아닌 **모듈화/상용화/템플릿화**를 최종 목표로 심도 깊게 진행합니다.

### 2.2 콘텐츠 본연의 질 고도화 (Content Advancement)
*   **아키텍처 구분 및 공감성 현실화**: 각 결과의 도출 아키텍처(성향 알고리즘) 구조는 보존하되, 사용자가 답변을 고민하는 **질문 내용**의 현실성 및 공감성을 높여 몰입감을 증폭시킵니다.
*   **재미있는 해설 확충**: 각 문항별 파라미터가 명확히 개성을 드러내도록 디자인하며, 유저가 마주하는 결과 내용(해설) 역시 타인에게 즉시 보여주고 싶을 만큼의 재미와 공감을 포함하도록 각본을 고도화합니다.

### 2.3 전면적 데이터베이스화 및 메타데이터 (Database & SEO)
*   **해시태그 메타 데이터화 (#)**: `#외향형`, `#리더십`, `#힐링` 등의 체계적인 해시태그 분류를 메타데이터에 삽입하여, 향후 빅데이터 분석 파이프라인의 검색, 분류 및 트렌드 분석 풀을 구축합니다.
*   **오픈 그래프 동적 주입의 한계 돌파 (Supabase Edge Functions)**:
    *   (문제) 카카오톡과 같은 SNS 공유 로봇(Crawler)은 브라우저 JavaScript를 실행하지 않아, 클라이언트에서 JS로 동적 할당하는 `og:image` 및 `og:title` 값을 가져가지 못합니다.
    *   (해결) 공유 전용 URL 구조(`https://.../share?result=leader`)를 수립하고, **서버리스 엣지 함수(Edge Functions)**가 URL을 인터셉트하여 해당 결과에 맞는 메타 태그가 심어진 순수 빈 HTML을 반환한 직후 실 결과 페이지로 리다이렉트 시키도록 파이프라인을 구축합니다.
*   **JSONB 기반의 스키마 분리 설계 정교화**:
    *   `User_Result_DB`: `uuid`, `test_id` (단일 유저 식별용 릴레이션 필수), `final_result`, `utm_source`, `timestamp`. (식별 불가 익명 세션 수집)
    *   `Event_Log_DB`: `uuid`, `test_id`, `question_id`, `dwell_time_ms`, `drop_off_flag` 등 사용자 행동 단위 로그.
    *   `Test_Meta_DB`: 여러 테이블로 파편화하여 관계성을 주지 않고, **Supabase PostgreSQL의 초강력 JSONB 데이터 타입**을 활용하여 `questions`, `weights`, `results` 해설 텍스트 등을 단일 필드에 통째로 이관(Fetch). 프론트엔드 파싱 및 백오피스 관리가 극적으로 단순화됩니다.

### 2.4 극정밀 텔레메트리 및 어뷰징 쉴드 (Telemetry & Abuse Protection)
*   **체류 시간(Dwell Time) 왜곡 보정 (Page Visibility API)**: 유저가 딴짓(카카오톡 확인 등 앱 이탈)을 하여 타이머가 계속 돌아가는 Background 상태를 데이터 훼손(예: 체류시간 30분)으로 간주합니다. 브라우저의 `document.hidden` API를 트리거로 타이머를 정지/재개하여 **순수한 문항 고민 시간**만을 측정합니다. (종료 전송은 메인 스레드를 막지 않는 `navigator.sendBeacon` 유지를 확정합니다)
*   **봇 트래픽 격리 (Honeypot 필드)**: 인간 유저 눈에는 보이지 않지만, HTML 소스코드에만 살아있는 '가짜 버튼/체크박스' 컴포넌트를 주입합니다. 무분별한 봇이 이를 클릭할 경우 해당 UUID 트래픽은 데이터베이스 레이어 단계에서 폐기 처리(Drop)됩니다.
*   **다중 테스트(호기심) 보정 로직 개발**:
    *   본인 유저 경험 외에 타인의 결과가 궁금해 '다시 하기'로 연타하는 횟수가 생길 경우 핵심 분석 데이터 세트가 위험해집니다.
    *   가장 순도가 높은 **첫 번째와 두 번째 테스트 정보만을 핵심(User_Result_DB)으로 분류**하여 로깅합니다.
    *   세 번째 이상 초과분은 단순한 '흥행수'로 뭉뜽그린 횟수 카운터로 방향을 전환합니다. (개인화된 Count 로직과 테스트 전역(Global) Count 로직을 Supabase 단에서 이원화 구축).

### 2.5 동적 추천 로직 및 점유율 강화 UI (Recommendation & UX)
*   **추천 테스트 4선 동적 로직 (Recommendation URL)**: 임의 배정(하드코딩)되어있던 배너 URL 방식을 철폐합니다. 4개 추천 리스트의 등재 기준(분류, 해시태그 등)을 명확하게 도출하고, Supabase Data Retrieval 로직을 구현하여 상황(알고리즘)에 맞게 배너가 송출되도록 합니다.
*   **공유 페이지 UI 최적화**: 공유를 받아 외부에서 진입한 유저에게는, 결과 메인 일러스트레이션을 필두로 `결과 보기 (공유 받은 사람용 타겟)`와 `테스트 시작하기 (신규 유입용)` 두 개의 명확한 버튼으로 동선을 갈라주어야 합니다.
*   **Island Test 에셋 보강**: 핵심 모듈임에도 메인 진입용 파노라마 배너가 부족했습니다. `index.html` 및 `test_list.html` 기사 섹션에 정확히 호환되는 거대 1200x330 메인 히어로 배너를 구축해야 합니다.

---

## 3. 차후 논의 사항 (Parked Items for Next Sprints)
본 단계에서는 우선순위에서 밀려 있으나 향후 고도화를 위해 기획된 항목들입니다.
1. **이탈률(Drop-off) 방어 레이아웃**: 시각적 피드백/프로그레스 바의 섬세한 조율 및 중간 휴게(광고) 로딩 구간의 마이크로 애니메이션 타이밍 설계 논의.
2. **조합형 공감성 증대 로직**: 최고점/최저점 등 유저의 델타 스탯을 조합해 해설 텍스트에 세밀하고 동적인 문자열을 삽입/결합하는 추가 공감 알고리즘 개발.
